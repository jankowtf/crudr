---
title: "Implementation for package `settings`"
author: "Janko Thyson"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{README}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
library(crudr)
stand_alone <- TRUE
knitr::opts_chunk$set(comment = "#>", collapse = TRUE)
```

# UML

```{r echo=FALSE}
crudr_uml <- '
  @startuml
  ICrud *-- Crud: implements <
  Crud <|-- Crud.Settings: extends <

  class ICrud {
    +init()
    +has()
    +create()
    +read()
    +update()
    +delete()
    +reset()
    -stopIfInterface()
  }
  class Crud {
    +main: environment
    -initial_state: list
    -stopIfEmpty()
    -createMessage(),
    -cacheInitialState()
  }
  class Crud.Settings {
    +main: function
    -cacheInitialState()
  }
  @enduml
'
uml_file <- crudr:::plantuml3(crudr_uml, 'Architecture', filename = "uml")
```

![UML](`r uml_file`)

# Instantiate 

```{r, eval = stand_alone}
inst <- Crud.Settings$new()
```

# Init

```{r, eval = stand_alone}
inst$init(a = 1, b = 2)
inst$getMain()
## --> this is actually the return value of calling 
##     `settings::options_manager(a = 1, b = 2)`
inst$getMain()()
```

# Has 

```{r, eval = stand_alone}
inst$has("a")
inst$has("b")
inst$has("a", "b")

inst$has("c")
inst$has("a", "c")
```

# Create

```{r, eval = stand_alone}
inst$create(c = 3)
inst$create(d = 4, f = 5)
inst$read()

try(inst$create(c = 30))
inst$read()
## --> c already existed with value = 3
inst$create(c = 30, strict = 1)
try(inst$create(c = 30, strict = 2))
try(inst$create(c = 30, strict = 3))
inst$create(c = 30, overwrite = TRUE)
inst$read()
## --> c overwritten
```

# Read

```{r, eval = stand_alone}
inst$read()
inst$read("a")
inst$read("a", "b")

inst$read("a", "b", "x")
try(inst$read("a", "b", "x", strict = 3))
```

# Update

```{r, eval = stand_alone}
inst$read("a")
inst$update(a = 10)
inst$read("a")

inst$read("a", "b")
inst$update(a = 1000, b = 2000)
inst$read("a", "b")

inst$update(x = 99)
inst$read("x")

inst$read("a", "x")
inst$update(a = 1, x = 99)
try(inst$update(a = 1, x = 99, strict = 3))
inst$read("a", "x")
```

# Delete

```{r, eval = stand_alone}
inst$read()
inst$delete("f")

inst$delete("d", "c")
inst$read()

inst$delete("x")
inst$read()
inst$delete("b", "x")
try(inst$delete("b", "x", strict = 3))
inst$read()
```

# Reset

```{r, eval = stand_alone}
inst$reset()
inst$read()

inst$reset(type = "hard")
inst$read()
```

